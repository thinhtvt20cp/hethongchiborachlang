
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>H·ªá th·ªëng Chi b·ªô ·∫§p R·∫°ch LƒÉng</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{display:flex;height:100vh;background:#f4f6f8}
th:nth-child(1), td:nth-child(1) { width: 60px;  text-align:center } /* STT */
th:nth-child(3), td:nth-child(3) { width: 80px;  text-align:center } /* Nam */
th:nth-child(4), td:nth-child(4) { width: 80px;  text-align:center } /* N·ªØ */
th:nth-child(5), td:nth-child(5) { width: 90px;  text-align:center } /* Quan h·ªá */
th:nth-child(6), td:nth-child(6) { width: 140px } /* CCCD */
th:nth-child(7), td:nth-child(7) { width: 140px } /* BHYT */
th:nth-child(8), td:nth-child(8) { width: 130px } /* ƒêi·ªán tho·∫°i */
/* ===== C·ªòT QUAN H·ªÜ ‚Äì C·ªê ƒê·ªäNH CH·ªÆ ===== */
#chuHoTable th:nth-child(5),
#chuHoTable td:nth-child(5) {
    width: 90px;          /* c·ªë ƒë·ªãnh ƒë·ªô r·ªông */
    min-width: 90px;
    max-width: 90px;
    text-align: center;
    white-space: nowrap;  /* KH√îNG xu·ªëng d√≤ng */
    font-weight: 600;
}
/* ===== T√î M√ÄU H√ÄNG CH·ª¶ H·ªò ===== */
.tr-chuho {
    background: #fff3cd !important;   /* v√†ng nh·∫°t */
    font-weight: 600;
}
/* ===== ACCOUNT BOTTOM ===== */
.account{
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    background:#ff6f00;
    padding:12px;
    border-top:2px solid rgba(255,255,255,.3);
}
.account-info{
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    color:#fff;
}

.account-info img{
    width:42px;
    height:42px;
    border-radius:50%;
    background:#fff;
}

.account-name{
    font-weight:bold;
    font-size:14px;
}

.account-role{
    font-size:12px;
    opacity:.9;
}

.account-menu{
    display:none;
    position:absolute;
    bottom:60px;
    left:12px;
    right:12px;
    background:#fff;
    border-radius:8px;
    box-shadow:0 4px 10px rgba(0,0,0,.15);
    overflow:hidden;
}

.account-menu div{
    padding:10px;
    cursor:pointer;
    font-size:14px;
}

.account-menu div:hover{
    background:#fff3e6;
}

.gender-filter button{
    padding:6px 14px;
    border:1px solid #ff6f00;
    background:#fff;
    color:#ff6f00;
    border-radius:20px;
    cursor:pointer;
    font-weight:600;
}
.gender-filter button.active{
    background:#ff6f00;
    color:#fff;
}
.highlight-row{
    outline:2px solid #2196f3;
    background:#e3f2fd !important;
}

/* ===== SIDEBAR ===== */
.sidebar{width:300px;background:#ff8c2a;display:flex;flex-direction:column}
.sidebar-header{background:#ff6f00;padding:20px;display:flex;align-items:center;gap:15px}
.logo{width:60px;height:60px;border-radius:50%;overflow:hidden;background:#fff}
.logo img{width:100%;height:100%;object-fit:cover}
.title{font-size:18px;font-weight:bold;line-height:1.3}
.sidebar{
    width:300px;
    background:#ff8c2a;
    display:flex;
    flex-direction:column;
    position:relative;
}


/* ===== MENU ===== */
.menu{padding:15px;overflow:auto}
.menu-item{
    display:flex;align-items:center;gap:12px;
    background:rgba(255,255,255,.35);
    padding:12px;margin-bottom:10px;
    border-radius:6px;cursor:pointer;font-weight:600
}
.menu-item:hover,.menu-item.active{
    background:#fff;border-left:6px solid #ff6f00
}
.menu-item img{width:28px;height:28px}

.submenu{display:none;margin-left:38px;margin-bottom:10px}
.submenu-item{
    padding:8px 10px;background:rgba(255,255,255,.6);
    border-radius:5px;margin-bottom:6px;
    cursor:pointer;font-size:14px
}
.submenu-item:hover{background:#fff}

/* ===== CONTENT ===== */
.content{flex:1;background:#fff;padding:20px;display:flex;flex-direction:column}
.top-bar{display:flex;gap:10px;margin-bottom:10px}
.top-bar input{
    flex:1;padding:10px 15px;border-radius:20px;border:none;
    background:#ff7a00;color:#fff
}
.top-bar input::placeholder{color:#fff}
.top-bar button{
    border:none;background:#ff7a00;color:#fff;
    padding:10px 14px;border-radius:50%
}
.breadcrumb{font-size:14px;margin-bottom:10px;text-decoration:underline}
.content-box{flex:1;background:#f0f0f0;border-radius:10px;padding:15px;overflow:hidden}

/* ===== TABLE ===== */
.search-box{display:flex;align-items:center;gap:10px}
.search-box input{
    width:280px;padding:8px 12px;
    border-radius:20px;border:1px solid #ccc
}
.table-wrap{
    height:100%;overflow:auto;background:#fff;border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,.1)
}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{
    background:linear-gradient(135deg,#ff8c2a,#ff6f00);
    color:#fff;position:sticky;top:0
}
td.name{
    text-align:left;
    min-width:220px;
    white-space:nowrap;
    padding-left:10px
}
tr:nth-child(even){
    background:#fafafa;
}
tr:hover{
    background:#fff3e6;
}


/* ===== HIGHLIGHT ===== */
.highlight{
    background:#a8d8ff;
    padding:2px 4px;
    border-radius:3px
}
/* D√íNG ƒê∆Ø·ª¢C T√åM TH·∫§Y */
.found-row{
    outline:3px solid #ff6f00;
    outline-offset:-2px;
    background:#ffe0b2 !important;
}

/* B√îI CH·ªÆ */
.highlight{
    background:#7ecbff;
    padding:2px 4px;
    border-radius:3px;
}

</style>
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <img src="https://i.pinimg.com/736x/e5/4c/92/e54c920cc8303e39430071926b72d087.jpg">
        </div>
        <div class="title">H·ªÜ TH·ªêNG CHI B·ªò<br>·∫§P R·∫†CH LƒÇNG</div>
    </div>
    
<!-- ===== ACCOUNT ===== -->
<div class="account">
    <div class="account-info" onclick="toggleAccountMenu()">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
        <div>
            <div class="account-name">Admin</div>
            <div class="account-role">Qu·∫£n tr·ªã</div>
        </div>
    </div>

    <div class="account-menu" id="accountMenu">
        <div onclick="alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn')">üîë ƒê·ªïi m·∫≠t kh·∫©u</div>
        <div onclick="logout()">üö™ ƒêƒÉng xu·∫•t</div>
    </div>
</div>

<!-- ===== Menu ===== -->


    <div class="menu">

        <div class="menu-item" onclick="toggleSub(this)">
            <img src="https://png.pngtree.com/png-vector/20220819/ourmid/pngtree-rounded-vector-icon-with-flat-eco-green-color-depicting-demography-chart-vector-png-image_19602230.png">
            <span>Th√¥ng tin nh√¢n kh·∫©u</span>
        </div>

        <div class="submenu">
            <div class="submenu-item" onclick="loadDanhSach()">üìã Danh s√°ch nh√¢n kh·∫©u</div>
        <div class="submenu-item" onclick="loadChuHo()">üè† Danh s√°ch ch·ªß h·ªô</div>
        </div>
        
    

        <div class="menu-item" onclick="loadSimple(this,'ƒê·∫£ng vi√™n Chi b·ªô')">
            <img src="https://hienlaptop.com/wp-content/uploads/2024/12/vector-bua-liem-17.png">
            <span>ƒê·∫£ng vi√™n Chi b·ªô</span>
        </div>

<!-- ===== ·∫§P ƒê·ªòI ===== -->
<div class="menu-item" onclick="toggleSub(this)">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Head_badge_of_the_Vietnam_Self-Defence_Militia.svg/250px-Head_badge_of_the_Vietnam_Self-Defence_Militia.svg.png">
    <span>·∫§p ƒë·ªôi</span>
</div>

<div class="submenu">
<div class="submenu-item" onclick="loadTraCuuCongDan()">
    üîç Tra c·ª©u th√¥ng tin c√¥ng d√¢n
</div>

    <div class="submenu-item" onclick="loadCongNhan('18-45')">
        üë∑ C√¥ng nh√¢n 18‚Äì45 tu·ªïi
    </div>

    <div class="submenu-item" onclick="loadCongNhan('18-27')">
        üë∑ C√¥ng nh√¢n 18‚Äì27 tu·ªïi
    </div>

    <div class="submenu-item" onclick="loadSimple(this,'D√¢n qu√¢n t·ª± v·ªá')">
        ü™ñ D√¢n qu√¢n t·ª± v·ªá
    </div>

    <!-- NVQS -->
    <div class="submenu-item" onclick="toggleSub(this)">
        üéØ Danh s√°ch NVQS
    </div>

    <div class="submenu">
        <div class="submenu-item" onclick="loadNVQS('dot1')">üìÑ S∆° tuy·ªÉn ƒë·ª£t 1</div>
        <div class="submenu-item" onclick="loadNVQS('dot2')">ü©∫ Kh√°m tuy·ªÉn ƒë·ª£t 2</div>
        <div class="submenu-item" onclick="loadNVQS('trungtuyen')">‚≠ê Tr√∫ng tuy·ªÉn</div>
    </div>

</div>

        

        <div class="menu-item" onclick="loadSimple(this,'H·ªôi N√¥ng d√¢n')">
            <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/08/logo-hoi-nong-dan-viet-nam.png">
            <span>H·ªôi N√¥ng d√¢n</span>
        </div>

        <div class="menu-item" onclick="loadSimple(this,'H·ªôi Ph·ª• n·ªØ')">
            <img src="https://upload.wikimedia.org/wikipedia/vi/d/df/Logo_H%E1%BB%99i_LHPN_Vi%E1%BB%87t_Nam.png">
            <span>H·ªôi Ph·ª• n·ªØ</span>
        </div>

        <div class="menu-item" onclick="loadSimple(this,'H·ªôi C·ª±u chi·∫øn binh')">
            <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/08/logo-hoi-cuu-chien-binh-viet-nam.png">
            <span>H·ªôi C·ª±u chi·∫øn binh</span>
        </div>

        <div class="menu-item" onclick="loadSimple(this,'Chi ƒëo√†n')">
            <img src="https://upload.wikimedia.org/wikipedia/vi/0/09/Huy_Hi%E1%BB%87u_%C4%90o%C3%A0n.png">
            <span>Chi ƒëo√†n</span>
        </div>

    </div>
</div>

<!-- ===== CONTENT ===== -->
<div class="content">
    <div class="top-bar">
   <input placeholder="Tra c·ª©u nhanh c√¥ng d√¢n..."
       oninput="quickGlobalSearch(this)"
       onkeydown="if(event.key==='Enter') nextGlobalResult()">
        <button>üîç</button>
    </div>

    <div class="breadcrumb" id="breadcrumb">Trang ch·ªß</div>

    <div class="content-box" id="mainContent">
        Ch·ªçn ch·ª©c nƒÉng b√™n tr√°i ƒë·ªÉ hi·ªÉn th·ªã d·ªØ li·ªáu
    </div>
</div>

<script>
/* ================== LOGIN ================== */
const loginUser = JSON.parse(localStorage.getItem("loginUser"));
if(!loginUser){
    location.href="login.html";
}

/* ================== SHEET ================== */
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT-knMwcoxT3R9Qbmr8wAEvGR4YKo4Hdq0_XfRnHJArHkACtqan8RjMV1Zve1a9KiYXUZNBmQO0ssq0/pub?gid=1811940739&single=true&output=csv";

/* ================== MENU ================== */
function toggleSub(el){
    const sub = el.nextElementSibling;
    sub.style.display = sub.style.display === "block" ? "none" : "block";
}
function loadSimple(el,name){
    document.getElementById("breadcrumb").innerText = "Trang ch·ªß / " + name;
    document.getElementById("mainContent").innerHTML =
        `<h3 style="color:#ff6f00">${name}</h3><p>ƒêang c·∫≠p nh·∫≠t‚Ä¶</p>`;
}

/* ================== DANH S√ÅCH NH√ÇN KH·∫®U ================== */
let matchedRows=[], currentIndex=-1;

function loadDanhSach(){
    document.getElementById("breadcrumb").innerText =
        "Trang ch·ªß / Th√¥ng tin nh√¢n kh·∫©u / Danh s√°ch";

    document.getElementById("mainContent").innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="color:#ff6f00">üìã DANH S√ÅCH NH√ÇN KH·∫®U</h3>
            <div class="search-box">
                <input placeholder="T√¨m h·ªç t√™n, nƒÉm sinh, CCCD"
                       oninput="quickFilter(this)"
                       onkeydown="if(event.key==='Enter')nextResult()">
                <button onclick="prevResult()">‚¨Ü</button>
                <button onclick="nextResult()">‚¨á</button>
                <span id="resultCount"></span>
            </div>
        </div>
        <div class="table-wrap"><table id="dataTable"></table></div>
    `;
    fetch(sheetURL).then(r=>r.text()).then(renderNhanKhau);
}

function renderNhanKhau(csv){
    const rows = csv.trim().split("\n").map(r=>r.split(",").map(c=>c.replace(/"/g,"")));
    let html=`<tr>
        <th>STT</th><th>H·ªç v√† t√™n</th><th>Nam</th><th>N·ªØ</th>
        <th>Quan h·ªá</th><th>CCCD</th><th>BHYT</th><th>ƒêi·ªán tho·∫°i</th><th>Ghi ch√∫</th>
    </tr>`;
    for(let i=1;i<rows.length;i++){
        const r=rows[i];
        html+=`
        <tr class="${r[4]==='Ch·ªß h·ªô'?'tr-chuho':''}">
            <td>${r[0]}</td><td class="name">${r[1]}</td>
            <td>${r[2]}</td><td>${r[3]}</td>
            <td>${r[4]}</td><td>${r[5]}</td>
            <td>${r[6]}</td><td>${r[7]}</td><td>${r[8]}</td>
        </tr>`;
    }
    document.getElementById("dataTable").innerHTML=html;
}

/* ===== t√¨m ki·∫øm ===== */
function quickFilter(input){
    const key=input.value.toLowerCase();
    matchedRows=[]; currentIndex=-1;
    document.querySelectorAll("#dataTable tr").forEach((row,i)=>{
        if(i===0) return;
        row.classList.remove("found-row");
        row.querySelectorAll("td").forEach(td=>td.innerHTML=td.textContent);
        if(!key){row.style.display="";return;}
        const txt=row.innerText.toLowerCase();
        if(txt.includes(key)){
            matchedRows.push(row);
            row.querySelectorAll("td")[1].innerHTML=
                row.querySelectorAll("td")[1].textContent.replace(
                    new RegExp(`(${key})`,"gi"),`<span class="highlight">$1</span>`);
        }else row.style.display="none";
    });
    document.getElementById("resultCount").innerText=
        key?`C√≥ ${matchedRows.length} k·∫øt qu·∫£`:"";
}
function nextResult(){ if(!matchedRows.length)return;
    currentIndex=(currentIndex+1)%matchedRows.length; jump();}
function prevResult(){ if(!matchedRows.length)return;
    currentIndex=(currentIndex-1+matchedRows.length)%matchedRows.length; jump();}
function jump(){
    matchedRows.forEach(r=>r.classList.remove("found-row"));
    matchedRows[currentIndex].classList.add("found-row");
    matchedRows[currentIndex].scrollIntoView({behavior:"smooth",block:"center"});
}

/* ================== C√îNG NH√ÇN ================== */
function loadCongNhan(type){
    const min=18, max=(type==="18-27"?27:45);
    document.getElementById("breadcrumb").innerText =
        `Trang ch·ªß / ·∫§p ƒë·ªôi / C√¥ng nh√¢n ${min}-${max}`;

    document.getElementById("mainContent").innerHTML=`
        <h3 style="color:#ff6f00">üë∑ C√îNG NH√ÇN ${min}-${max} TU·ªîI</h3>
        <div class="table-wrap"><table id="dataTable"></table></div>`;

    fetch(sheetURL).then(r=>r.text()).then(csv=>renderCongNhan(csv,min,max));
}
function renderCongNhan(csv,min,max){
    const year=new Date().getFullYear();
    const rows=csv.trim().split("\n").map(r=>r.split(",").map(c=>c.replace(/"/g,"")));
    let html=`<tr>
        <th>STT</th><th>H·ªç t√™n</th><th>NƒÉm sinh</th><th>Gi·ªõi t√≠nh</th>
        <th>Quan h·ªá</th><th>CCCD</th><th>BHYT</th><th>ƒêi·ªán tho·∫°i</th><th>Ghi ch√∫</th>
    </tr>`;
    let count=0;
    for(let i=1;i<rows.length;i++){
        const r=rows[i];
        if(r[2]){
            let age=year-r[2];
            if(age>=min&&age<=max){
                count++; html+=rowCN(r,"Nam",r[2]);
            }
        }
        if(r[3]){
            let age=year-r[3];
            if(age>=min&&age<=max){
                count++; html+=rowCN(r,"N·ªØ",r[3]);
            }
        }
    }
    document.getElementById("dataTable").innerHTML=
        count?html:`<tr><td colspan="9">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
}
function rowCN(r,gt,ns){
    return `<tr>
        <td>${r[0]}</td><td class="name">${r[1]}</td>
        <td>${ns}</td><td>${gt}</td>
        <td>${r[4]}</td><td>${r[5]}</td>
        <td>${r[6]}</td><td>${r[7]}</td><td>${r[8]}</td>
    </tr>`;
}

/* ================== TRA C·ª®U C√îNG D√ÇN ================== */
let searchResults=[], searchIndex=-1;

function loadTraCuuCongDan(){
    document.getElementById("breadcrumb").innerText =
        "Trang ch·ªß / ·∫§p ƒë·ªôi / Tra c·ª©u c√¥ng d√¢n";

    document.getElementById("mainContent").innerHTML=`
        <div style="display:flex;justify-content:space-between">
            <h3 style="color:#ff6f00">üîç TRA C·ª®U C√îNG D√ÇN</h3>
            <div><button onclick="prevSearch()">‚¨Ü</button>
                 <button onclick="nextSearch()">‚¨á</button></div>
        </div>
        <input id="searchInput" placeholder="T√™n, nƒÉm sinh, CCCD..."
               oninput="searchCongDan()"
               onkeydown="if(event.key==='Enter')nextSearch()">
        <span id="resultCount"></span>
        <div class="table-wrap"><table id="dataTable"></table></div>`;
    fetch(sheetURL).then(r=>r.text()).then(renderTraCuu);
}
function renderTraCuu(csv){
    const rows=csv.trim().split("\n").map(r=>r.split(",").map(c=>c.replace(/"/g,"")));
    let html=`<tr>
        <th>STT</th><th>H·ªç t√™n</th><th>NƒÉm sinh</th><th>Gi·ªõi t√≠nh</th>
        <th>Quan h·ªá</th><th>CCCD</th><th>BHYT</th><th>ƒêi·ªán tho·∫°i</th><th>Ghi ch√∫</th>
    </tr>`;
    for(let i=1;i<rows.length;i++){
        if(rows[i][2]) html+=rowCN(rows[i],"Nam",rows[i][2]);
        if(rows[i][3]) html+=rowCN(rows[i],"N·ªØ",rows[i][3]);
    }
    document.getElementById("dataTable").innerHTML=html;
}
function searchCongDan(){
    const key=document.getElementById("searchInput").value.toLowerCase();
    searchResults=[]; searchIndex=-1;
    document.querySelectorAll("#dataTable tr").forEach((r,i)=>{
        if(i===0) return;
        r.classList.remove("found-row");
        r.querySelectorAll("td").forEach(td=>td.innerHTML=td.textContent);
        if(!key){r.style.display="";return;}
        if(r.innerText.toLowerCase().includes(key)){
            searchResults.push(r);
            r.querySelectorAll("td").forEach(td=>{
                td.innerHTML=td.textContent.replace(
                    new RegExp(`(${key})`,"gi"),`<span class="highlight">$1</span>`);
            });
        }else r.style.display="none";
    });
    document.getElementById("resultCount").innerText=
        key?`T√¨m th·∫•y ${searchResults.length} k·∫øt qu·∫£`:"";
}
function nextSearch(){ if(!searchResults.length)return;
    searchIndex=(searchIndex+1)%searchResults.length; jumpSearch();}
function prevSearch(){ if(!searchResults.length)return;
    searchIndex=(searchIndex-1+searchResults.length)%searchResults.length; jumpSearch();}
function jumpSearch(){
    searchResults.forEach(r=>r.classList.remove("found-row"));
    searchResults[searchIndex].classList.add("found-row");
    searchResults[searchIndex].scrollIntoView({behavior:"smooth",block:"center"});
}

/* ================== ACCOUNT ================== */
function toggleAccountMenu(){
    const m=document.getElementById("accountMenu");
    m.style.display=m.style.display==="block"?"none":"block";
}
function logout(){
    if(confirm("ƒêƒÉng xu·∫•t?")){
        localStorage.removeItem("loginUser");
        location.href="login.html";
    }
}

let globalRows = [];
let globalMatches = [];
let globalIndex = -1;

/* Load d·ªØ li·ªáu 1 l·∫ßn */
fetch(sheetURL)
    .then(r=>r.text())
    .then(csv=>{
        globalRows = csv.trim().split("\n")
            .slice(1)
            .map(r=>r.split(",").map(c=>c.replace(/"/g,"")));
    });

/* Tra c·ª©u nhanh */
function quickGlobalSearch(input){
    const key = input.value.toLowerCase().trim();
    globalMatches = [];
    globalIndex = -1;

    if(!key){
        document.getElementById("mainContent").innerHTML =
            "Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ tra c·ª©u nhanh";
        return;
    }

    let html = `
    <h3 style="color:#ff6f00">‚ö° K·∫æT QU·∫¢ TRA C·ª®U NHANH</h3>
    <div class="table-wrap">
    <table id="quickTable">
    <tr>
        <th>STT</th><th>H·ªç t√™n</th><th>NƒÉm sinh</th><th>Gi·ªõi t√≠nh</th>
        <th>Quan h·ªá</th><th>CCCD</th><th>BHYT</th><th>ƒêi·ªán tho·∫°i</th>
    </tr>`;

    globalRows.forEach(r=>{
        const text = r.join(" ").toLowerCase();
        if(text.includes(key)){
            if(r[2]) addQuickRow(r,"Nam",r[2]);
            if(r[3]) addQuickRow(r,"N·ªØ",r[3]);
        }
    });

    html += `</table></div>`;
    document.getElementById("mainContent").innerHTML = html;

    function addQuickRow(r,gt,ns){
        const row = `
        <tr>
            <td>${r[0]}</td>
            <td class="name">${highlight(r[1],key)}</td>
            <td>${ns}</td>
            <td>${gt}</td>
            <td>${r[4]}</td>
            <td>${highlight(r[5],key)}</td>
            <td>${highlight(r[6],key)}</td>
            <td>${highlight(r[7],key)}</td>
        </tr>`;
        html += row;
        globalMatches.push(row);
    }
}

/* Highlight ch·ªØ */
function highlight(text,key){
    if(!text) return "";
    return text.replace(
        new RegExp(`(${key})`,"gi"),
        `<span class="highlight">$1</span>`
    );
}

/* Enter / ‚¨á */
function nextGlobalResult(){
    const rows = document.querySelectorAll("#quickTable tr");
    if(rows.length<=1) return;

    rows.forEach(r=>r.classList.remove("found-row"));
    globalIndex = (globalIndex+1) % (rows.length-1);
    const row = rows[globalIndex+1];
    row.classList.add("found-row");
    row.scrollIntoView({behavior:"smooth",block:"center"});
}

let GLOBAL_DATA = [];
let QUICK_RESULTS = [];
let QUICK_INDEX = -1;

fetch(sheetURL)
    .then(r => r.text())
    .then(csv => {
        const rows = csv.trim().split("\n")
            .map(r => r.split(",").map(c => c.replace(/"/g,"")));

        for(let i=1;i<rows.length;i++){
            const [
                stt, hoten, nam, nu, quanhe,
                cccd, bhyt, dienthoai, ghichu
            ] = rows[i];

            if(nam){
                GLOBAL_DATA.push({
                    stt, hoten, namsinh: nam,
                    gioitinh:"Nam", quanhe, cccd, bhyt, dienthoai, ghichu
                });
            }
            if(nu){
                GLOBAL_DATA.push({
                    stt, hoten, namsinh: nu,
                    gioitinh:"N·ªØ", quanhe, cccd, bhyt, dienthoai, ghichu
                });
            }
        }
    });
let debounceTimer = null;

function quickGlobalSearch(input){
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(()=>{
        doQuickSearch(input.value.trim().toLowerCase());
    },150);
}
function doQuickSearch(key){
    QUICK_RESULTS = [];
    QUICK_INDEX = -1;

    if(!key){
        document.getElementById("mainContent").innerHTML =
            "Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ tra c·ª©u nhanh";
        return;
    }

    QUICK_RESULTS = GLOBAL_DATA.filter(d =>
        d.hoten.toLowerCase().includes(key) ||
        d.namsinh.includes(key) ||
        d.cccd.includes(key) ||
        d.bhyt.includes(key) ||
        d.dienthoai.includes(key)
    );

    renderQuickResult(key);
}
function renderQuickResult(key){
    let html = `
    <h3 style="color:#ff6f00">‚ö° TRA C·ª®U NHANH</h3>
    <div class="table-wrap">
    <table id="quickTable">
    <tr>
        <th>STT</th><th>H·ªç t√™n</th><th>NƒÉm sinh</th>
        <th>Gi·ªõi t√≠nh</th><th>Quan h·ªá</th>
        <th>CCCD</th><th>BHYT</th><th>ƒêi·ªán tho·∫°i</th>
    </tr>`;

    QUICK_RESULTS.forEach(d=>{
        html += `
        <tr>
            <td>${d.stt}</td>
            <td class="name">${mark(d.hoten,key)}</td>
            <td>${mark(d.namsinh,key)}</td>
            <td>${d.gioitinh}</td>
            <td>${d.quanhe}</td>
            <td>${mark(d.cccd,key)}</td>
            <td>${mark(d.bhyt,key)}</td>
            <td>${mark(d.dienthoai,key)}</td>
        </tr>`;
    });

    html += `</table></div>`;

    document.getElementById("mainContent").innerHTML = html;
}
function mark(text,key){
    if(!text) return "";
    return text.replace(
        new RegExp(`(${key})`,"gi"),
        `<span class="highlight">$1</span>`
    );
}
function nextGlobalResult(){
    const rows = document.querySelectorAll("#quickTable tr");
    if(rows.length<=1) return;

    rows.forEach(r=>r.classList.remove("found-row"));

    QUICK_INDEX++;
    if(QUICK_INDEX >= rows.length-1) QUICK_INDEX = 0;

    rows[QUICK_INDEX+1].classList.add("found-row");
    rows[QUICK_INDEX+1].scrollIntoView({block:"center"});
}

</script>


</body>
</html>

